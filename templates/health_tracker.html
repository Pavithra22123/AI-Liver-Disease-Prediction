<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Score Tracker - LiverAI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        .header { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px; text-align: center; }
        .header h1 { color: #667eea; font-size: 2.5em; margin-bottom: 10px; }
        
        .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: white; padding: 25px; border-radius: 15px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .stat-box .value { font-size: 3em; font-weight: bold; margin-bottom: 10px; }
        .stat-box .label { color: #666; font-size: 1.1em; }
        .stat-box.good .value { color: #4CAF50; }
        .stat-box.warning .value { color: #FF9800; }
        .stat-box.danger .value { color: #F44336; }
        
        .chart-container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .chart-container h2 { color: #667eea; margin-bottom: 20px; }
        
        .insights { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .insights h2 { color: #667eea; margin-bottom: 20px; }
        .insight-item { padding: 15px; background: #f5f5f5; border-radius: 8px; margin-bottom: 15px; }
        .insight-item strong { color: #667eea; }
        
        .back-btn { display: inline-block; background: white; color: #667eea; padding: 12px 30px; border-radius: 8px; text-decoration: none; font-weight: bold; transition: 0.3s; }
        .back-btn:hover { background: #667eea; color: white; transform: translateY(-2px); }
        
        .trend-indicator { font-size: 2em; }
        .trend-up { color: #4CAF50; }
        .trend-down { color: #F44336; }
        .trend-stable { color: #FF9800; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìà Health Score Tracker</h1>
            <p>Monitor your liver health progress over time</p>
            <br>
            <a href="{{ url_for('index') }}" class="back-btn">‚Üê Back to Dashboard</a>
        </div>

        {% if dates and values %}
        <!-- Statistics -->
        <div class="stats-row">
            <div class="stat-box {% if values[-1] >= 80 %}good{% elif values[-1] >= 60 %}warning{% else %}danger{% endif %}">
                <div class="value">{{ values[-1] }}</div>
                <div class="label">Current Score</div>
            </div>
            
            <div class="stat-box">
                <div class="value">{{ values|max }}</div>
                <div class="label">Best Score</div>
            </div>
            
            <div class="stat-box">
                <div class="value">{{ values|length }}</div>
                <div class="label">Total Tests</div>
            </div>
            
            <div class="stat-box">
                {% set trend = values[-1] - values[0] if values|length > 1 else 0 %}
                <div class="trend-indicator {% if trend > 0 %}trend-up{% elif trend < 0 %}trend-down{% else %}trend-stable{% endif %}">
                    {% if trend > 0 %}‚Üó{% elif trend < 0 %}‚Üò{% else %}‚Üí{% endif %}
                </div>
                <div class="label">Overall Trend</div>
            </div>
        </div>

        <!-- Chart -->
        <div class="chart-container">
            <h2>Health Score Timeline</h2>
            <canvas id="healthChart"></canvas>
        </div>

        <!-- Insights -->
        <div class="insights">
            <h2>üìä Health Insights</h2>
            
            {% set current = values[-1] %}
            {% set previous = values[-2] if values|length > 1 else current %}
            {% set change = current - previous %}
            
            <div class="insight-item">
                <strong>Current Status:</strong> 
                {% if current >= 80 %}
                    üü¢ Excellent! Your liver health is in good condition.
                {% elif current >= 60 %}
                    üü° Moderate. Consider following dietary recommendations.
                {% else %}
                    üî¥ Concerning. Please consult with a healthcare professional.
                {% endif %}
            </div>
            
            {% if values|length > 1 %}
            <div class="insight-item">
                <strong>Recent Change:</strong>
                {% if change > 0 %}
                    ‚úÖ Your score improved by {{ change }} points! Keep up the good work.
                {% elif change < 0 %}
                    ‚ö†Ô∏è Your score decreased by {{ -change }} points. Review your lifestyle habits.
                {% else %}
                    ‚û°Ô∏è Your score remained stable. Continue monitoring.
                {% endif %}
            </div>
            {% endif %}
            
            <div class="insight-item">
                <strong>Recommendation:</strong>
                {% if current < 70 %}
                    Schedule a follow-up appointment and follow your doctor's advice strictly.
                {% else %}
                    Continue healthy habits and regular monitoring every 3-6 months.
                {% endif %}
            </div>
        </div>
        
        {% else %}
        <div class="insights" style="text-align: center;">
            <h2>No Data Available</h2>
            <p>Take your first liver health test to start tracking your progress.</p>
            <br>
            <a href="{{ url_for('predict_form') }}" class="back-btn">Take a Test</a>
        </div>
        {% endif %}
    </div>

    <script>
        {% if dates and values %}
        const ctx = document.getElementById('healthChart').getContext('2d');
        
        // Create gradient
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(102, 126, 234, 0.5)');
        gradient.addColorStop(1, 'rgba(118, 75, 162, 0.1)');
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ dates | tojson }},
                datasets: [{
                    label: 'Health Score',
                    data: {{ values | tojson }},
                    borderColor: '#667eea',
                    backgroundColor: gradient,
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    pointBackgroundColor: '#667eea',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        padding: 12,
                        titleFont: { size: 14 },
                        bodyFont: { size: 13 }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + ' pts';
                            }
                        },
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
        {% endif %}
    </script>
</body>
</html>